<!DOCTYPE html>

<html lang="en">
<head>
    <link rel="icon" href="https://twemoji.maxcdn.com/v/latest/svg/1f6f5.svg">
<meta charset="utf-8"/>
<title>Vehicle Valuator</title>
<meta content="width=device-width, initial-scale=1" name="viewport"/>
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
<link href="data:application/manifest+json;base64,ewogICAgIm5hbWUiOiAiVmVoaWNsZSBWYWx1YXRvciIsCiAgICAic2hvcnRfbmFtZSI6ICJWYWx1YXRvciIsCiAgICAic3RhcnRfdXJsIjogIi8iLAogICAgImRpc3BsYXkiOiAic3RhbmRhbG9uZSIsCiAgICAiYmFja2dyb3VuZF9jb2xvciI6ICIjMTkxQTFBIiwKICAgICJ0aGVtZV9jb2xvciI6ICIjMTkxQTFBIiwKICAgICJpY29ucyI6IFsKICAgICAgewogICAgICAgICJzcmMiOiAiL3N0YXRpYy9pY29ucy9pY29uLTE5Mi5wbmciLAogICAgICAgICJzaXplcyI6ICIxOTJ4MTkyIiwKICAgICAgICAidHlwZSI6ICJpbWFnZS9wbmciCiAgICAgIH0sCiAgICAgIHsKICAgICAgICAic3JjIjogIi9zdGF0aWMvaWNvbnMvaWNvbi01MTIucG5nIiwKICAgICAgICAic2l6ZXMiOiAiNTEyeDUxMiIsCiAgICAgICAgInR5cGUiOiAiaW1hZ2UvcG5nIgogICAgICB9CiAgICBdCiAgfQ==" rel="manifest"/>
<style>/* -------------- global styles -------------- */
@font-face {
  font-family: 'UKNumberPlate';
  src: url('/static/UKNumberPlate.ttf') format('truetype');
  font-weight: normal;
  font-style: normal;
}

:root {
  --bg: #191A1A;
  --card: #202222;
  --border: #343636;
  --text: #FFFFFF;
  --muted: #B9D3E9;
  --accent: #05DF72;
  --plate: #D9FF00;
  --error: #ff4d4d;

  /* layout */
  --radius: 12px;
  --gap: 8px;

  /* fonts */
  --font-sans: 'Space Grotesk', sans-serif;
  --font-plate: 'UKNumberPlate', sans-serif;
}

/* auto‑switch to light palette */
@media (prefers-color-scheme: light) {
  :root {
    --bg: #F7F9FA;
    --card: #FFFFFF;
    --border: #DDE3E8;
    --text: #191A1A;
    --muted: #64748b;
  }
}

* { box-sizing: border-box; }

body {
  margin: 0;
  display: flex;
  min-height: 100vh;
  justify-content: center;
  align-items: center;
  font-family: var(--font-sans);
  background: var(--bg);
  color: var(--text);
}

/* ---------------- card shell ---------------- */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: 0 2px 4px rgba(0,0,0,.32);
  padding: 16px;
  width: min(100%, 400px);
  display: flex;
  flex-direction: column;
  gap: 24px;
}

/* util */
.stack { display: flex; flex-direction: column; gap: var(--gap); }

h1, h2 { margin: 0; font-size: 20px; text-align: center; }
.description { margin: 0; font-size: 14px; color: var(--muted); text-align: center; }

/* -------------- form controls -------------- */
label { font-size: 14px; margin-bottom: 4px; color: var(--muted); }
.visually-hidden { position: absolute; left: -10000px; top: auto; width: 1px; height: 1px; overflow: hidden; }

input {
  height: 48px;
  padding: 0 12px;
  font-size: 16px;
  font-family: var(--font-sans);
  font-weight: 500;
  color: var(--text);
  background: var(--border);
  border: none;
  border-radius: 6px;
  text-align: center;
}
input:invalid { outline: 2px solid var(--error); }

input::placeholder { color: var(--text); opacity: 1; }

#vrm {
  font-family: var(--font-plate);
  background: var(--plate);
  color: #000;
  letter-spacing: 1px;
}
#vrm::placeholder { color: #000; }

.button {
  height: 48px;
  padding: 0 12px;
  font-size: 16px;
  font-weight: 800;
  font-family: var(--font-sans);
  border: none;
  border-radius: 6px;
  cursor: pointer;
  display: flex; align-items: center; justify-content: center;
}
.button.primary { background: var(--text); color: var(--bg); }
.button.secondary { background: var(--border); color: var(--text); }
.button.invisible { background: transparent; color: var(--text); box-shadow: none; pointer-events: auto; }
.button[disabled] { opacity: .6; cursor: progress; }

/* spinner */
@keyframes spin { to { transform: rotate(360deg); } }
.spinner {
  width: 18px; height: 18px;
  border: 3px solid transparent;
  border-top-color: currentColor;
  border-radius: 50%;
  animation: spin .8s linear infinite;
}

/* valuation display */
.valuation { display: flex; flex-direction: column; align-items: center; gap: var(--gap); }
#valNum {
  font-size: 32px;
  font-weight: 600;
  color: var(--accent);
}

/* vehicle details table */
.vehicle-info { display: flex; flex-direction: column; gap: var(--gap); width: 100%; }
.info-row { display: flex; justify-content: space-between; font-size: 14px; }
.info-row span:first-child { color: var(--muted); font-weight: 500; }
.divider { height: 1px; width: 100%; background: var(--border); }

.button.primary:hover {
  background-color: rgba(255, 255, 255, 0.829);
  transition: background-color 0.2s ease;
}

.button.secondary:hover,
.button.invisible:hover {
  background-color: rgba(255, 255, 255, 0.068);
  transition: background-color 0.2s ease;
}

@media (max-width: 768px) {
  body {
    align-items: flex-start;
    min-height: 80vh;
    padding: 32px 16px 0 16px; /* top, right, bottom, left */
  }

  .card {
    margin: 0 auto;
    width: 100%;
  }
}

/* animation shell */
.card {
  transition: opacity 0.25s ease, transform 0.25s ease;
  will-change: opacity, transform;
}

/* fade-out effect */
.card.exiting {
  opacity: 0;
  transform: translateY(10px);
}

/* fade-in effect */
.card.entering {
  opacity: 0;
  transform: translateY(10px);
}
.card.entered {
  opacity: 1;
  transform: translateY(0);
}</style>
</head>
<body>
<template id="tpl-step1">
<div class="stack">
<h1>Vehicle Valuation</h1>
<p class="description">Enter your registration to start</p>
</div>
<div class="stack">
<input id="vrm" pattern="[A-Za-z0-9]{2,8}" placeholder="Enter Reg"/>
<button class="button primary" id="search">Search vehicle</button>
</div>
</template>
<template id="tpl-step2">
<div class="vehicle-info"></div>
<div class="stack">
<input id="mileage" min="0" placeholder="Enter mileage" type="number"/>
<button class="button primary" id="val">Value my vehicle</button>
<button class="button secondary invisible" id="wrong">Incorrect vehicle</button>
</div>
</template>
<template id="tpl-step3">
<div class="valuation stack">
<div id="valNum"></div>
<div class="description"></div>
</div>
<div class="stack">
<button class="button primary" id="acc">I would accept this offer</button>
<button class="button secondary" id="high">Value is too high</button>
<button class="button secondary" id="low">Value is too low</button>
</div>
</template>
<template id="tpl-step4">
<div class="stack" style="gap:32px">
<div class="stack">
<h2>Thanks for your feedback</h2>
<p class="description">We appreciate it—it helps us improve.</p>
</div>
<button class="button primary" id="again">Value another vehicle</button>
</div>
</template>
<template id="tpl-step5">
<div class="stack">
<h1>Enter vehicle details</h1>
<p class="description">Couldn’t identify that reg. Fill in manually.</p>
</div>
<div class="stack">
<input id="vrm" pattern="[A-Za-z0-9]{2,8}" placeholder="Registration" required=""/>
<input id="year" pattern="\d{4}" placeholder="Year" required=""/>
<input id="make" placeholder="Make" required=""/>
<input id="model" placeholder="Model" required=""/>
<input id="variant" placeholder="Variant (opt)"/>
<input id="bodystyle" placeholder="Body Style (opt)"/>
<button class="button primary" id="saveDetails">Continue</button>
<button class="button secondary invisible" id="back">Try different reg</button>
</div>
</template>
<div class="card" id="card" role="main"></div>
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {
  let step = 1;
  let VEH = {};
  const card   = document.getElementById('card');
  const VRM_RE = /^[A-Z0-9]{2,8}$/;

  // ---------- Pure local mock "DB" + helpers (no API calls at all) ----------
  const MAKES = [
    {make:"Yamaha", models:["MT-07","R6","Tracer 700","XSR700"]},
    {make:"Honda", models:["CBR600RR","CB650R","Africa Twin","Rebel 500"]},
    {make:"Kawasaki", models:["Ninja 650","Z650","Versys 650","Z900"]},
    {make:"Suzuki", models:["GSX-R600","SV650","V-Strom 650","GSX-S750"]},
    {make:"BMW", models:["F 800 R","F 850 GS","R 1200 GS","S 1000 R"]},
    {make:"Triumph", models:["Street Triple","Tiger 800","Bonneville T100","Trident 660"]},
    {make:"Ducati", models:["Monster 821","Scrambler Icon","Multistrada 950","Panigale 899"]}
  ];
  const VARIANTS = ["ABS", "Base", "Sport", "Touring", "SE"];
  const BODY = ["Motorcycle", "Naked", "Adventure", "Sport", "Tourer"];

  function hashStr(s){
    let h = 0;
    for (let i=0;i<s.length;i++) h = (h*31 + s.charCodeAt(i))>>>0;
    return h;
  }

  function lookupLocal(vrm){
    // Deterministic pseudo‑random based on VRM
    const h = hashStr(vrm);
    const makeIdx = h % MAKES.length;
    const modelList = MAKES[makeIdx].models;
    const model = modelList[h % modelList.length];
    const year = 2013 + (h % 12); // 2013–2024
    const variant = VARIANTS[(h>>3) % VARIANTS.length];
    const body = BODY[(h>>5) % BODY.length];

    return {
      vrm,
      year: String(year),
      make: MAKES[makeIdx].make,
      model,
      variant,
      BodyStyle: body
    };
  }

  function valueLocal(payload){
    // Simple fake valuation model:
    // base from year & model class, minus mileage depreciation
    const year = Number(payload.year) || 2018;
    const age = Math.max(0, (new Date().getFullYear()) - year);
    const modelFactor = 1 + ((hashStr(payload.model || "") % 30) / 100); // 1.00–1.29
    const base = 2500 * modelFactor * Math.max(0.6, 1 - age*0.06);       // age decay
    const miles = Number(payload.mileage) || 0;

    // mileage depreciation (very rough, just for demo)
    let dep = 0;
    if (miles > 80000) dep = 0.45;
    else if (miles > 60000) dep = 0.36;
    else if (miles > 40000) dep = 0.28;
    else if (miles > 30000) dep = 0.2;
    else if (miles > 20000) dep = 0.14;
    else if (miles > 10000) dep = 0.08;

    // add a small deterministic jitter so values don't look too round
    const jitter = ((hashStr(payload.vrm) % 200) - 100); // -100..+99
    const valuation = Math.max(600, Math.round(base * (1 - dep) + jitter));

    return {
      valuation,
      description: "Mock valuation: assumes good condition and full service history."
    };
  }

  function formatGBP(n){
    return new Intl.NumberFormat('en-GB', { style:'currency', currency:'GBP', maximumFractionDigits:0 }).format(n);
  }

  const withSpinner = (btn, fn) => {
    const spinner = document.createElement('div');
    spinner.className = 'spinner';
    const prev = btn.innerHTML;
    btn.innerHTML = '';
    btn.disabled   = true;
    btn.appendChild(spinner);
    return fn().finally(() => {
      btn.innerHTML = prev;
      btn.disabled = false;
    });
  };

  function fireConfettiAtCard() {
    const rect = card.getBoundingClientRect();
    const x = (rect.left + rect.width/2) / window.innerWidth;
    const y = (rect.top - 20) / window.innerHeight;
    confetti({ angle:90, spread:60, particleCount:80, origin:{x,y} });
  }

  function animateRender(cb) {
    card.classList.add('exiting');
    setTimeout(() => {
      card.classList.replace('exiting','entering');
      card.innerHTML = '';
      cb();
      void card.offsetWidth;
      card.classList.add('entered');
      setTimeout(() => card.classList.remove('entering','entered'), 250);
    }, 250);
  }

  function render() {
    animateRender(() => {
      const tpl = document.getElementById(`tpl-step${step}`);
      card.appendChild(tpl.content.cloneNode(true));

      if (step===1) {
        document.getElementById('search').onclick = () => {
          const input = document.getElementById('vrm');
          const vrm   = input.value.trim().toUpperCase();
          if (!VRM_RE.test(vrm)) return input.reportValidity();
          withSpinner(input.nextElementSibling, async () => {
            // local lookup every time
            VEH = lookupLocal(vrm);
            step=2; render();
          });
        };
      }

      if (step===5) {
        const vrmInput = document.getElementById('vrm');
        if (VEH.vrm) vrmInput.value = VEH.vrm;
        document.getElementById('saveDetails').onclick = () => {
          ['year','make','model','variant','BodyStyle'].forEach(k => {
            VEH[k] = document.getElementById(k==='BodyStyle'?'bodystyle':k).value.trim();
          });
          if (!VEH.year||!VEH.make||!VEH.model)
            return alert('Year, Make & Model are required.');
          VEH.vrm = vrmInput.value.trim().toUpperCase();
          step=2; render();
        };
        document.getElementById('back').onclick = () => { step=1; render(); };
      }

      if (step===2) {
        const container = card.querySelector('.vehicle-info');
        container.innerHTML = ['year','make','model','variant','BodyStyle']
          .map(k => `<div class="info-row"><span>${k}</span><span>${VEH[k]||'-'}</span></div><div class="divider"></div>`)
          .join('');
        document.getElementById('val').onclick = () => {
          const mileageInput = document.getElementById('mileage');
          const mileageStr = mileageInput.value;
          if (mileageStr === "") { mileageInput.reportValidity(); return; }
          VEH.mileage = mileageStr;
          withSpinner(document.getElementById('val'), async () => {
            Object.assign(VEH, valueLocal(VEH));
            step=3; render();
          });
        };
        document.getElementById('wrong').onclick = () => { VEH={}; step=1; render(); };
      }

      if (step===3) {
        fireConfettiAtCard();
        document.getElementById('valNum').textContent = formatGBP(VEH.valuation||0);
        card.querySelector('.description').textContent =
          "We assume the vehicle is in great condition and has complete service history";
        // Feedback buttons are now local no‑ops
        document.getElementById('acc').onclick  = ()=>{ step=4; render(); };
        document.getElementById('high').onclick = ()=>{ step=4; render(); };
        document.getElementById('low').onclick  = ()=>{ step=4; render(); };
      }

      if (step===4) {
        document.getElementById('again').onclick = () => { VEH={}; step=1; render(); };
      }
    });
  }

  render();
});
</script>

</body>
</html>
